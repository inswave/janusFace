<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Device Info</title>
</head>
<body>
  <textarea id="netInfoList" cols="110" rows="6"></textarea>
  <button id="netInfo" onclick="getNetInfo()" style="display: block">IP/MAC Address</button>
  <button id="painter" onclick="runPainter()">그림판 실행</button>
  <!--
  <div>
    <ul>
      <li>
        <a href='http://www.daum.net'>Daum</a>
      </li>
      <li>
        <a href='http://www.naver.com'>Naver</a>
      </li>
    </ul>
  </div>
  -->
  <script src="socket.io-client/socket.io.js"></script>
  <script>
    var socket = io('http://localhost:3101');

    function launch( launchOption ) {
      socket.emit( 'launch', launchOption );
    }

    function getNetInfo() {
      launch( {
//        cmd: 'getmac',
        cmd: 'ipconfig',
        args: ['/all'],
        options: {
//          debug: true,
          encoding: 'EUC-KR'
        }
      } );
    }

    function runPainter() {
      launch( {
        cmd: 'mspaint',
        args: [],
        options: {
          detached: true
        }
      } );
    }
    
    document.addEventListener( 'click', function(e) {
    	var srcEle = e.srcElement;
    	if ( srcEle.nodeName === 'A' ) {
        launch( {
          cmd: 'cmd',
          args: ['/s', '/c', 'start', srcEle.href],
          options: {
            detached: true
          }
        } );
    	}
    	e.preventDefault();
    } );

    socket.on( 'push', function( msg ) {
      var i,
          ip, mac,
          data = '',
          cmd = msg.cmd,
          result = msg.result;
//      console.log( msg );

      if ( cmd === 'ipconfig' ) {
        for ( i = 0; i < result.length; i++ ) {
          data += JSON.stringify(result[i]) + '\n';
          if ( result[i]['IPv4 주소'] ) {
            ip = result[i]['IPv4 주소'];
            mac = result[i]['물리적 주소'];
          }
        }

        document.querySelector('#netInfoList').value = data;
        alert( 'IP : ' + ip + '\nMAC : ' + mac );
      }


    } );
  </script>
</body>
</html>
